## Делаем первую игру

Мы будем редактировать файл `src/features/game/c/scene.tsx`. В нем описывается Сцена - корневой объект, содержащий внутри себя все трехмерное.

1. Для начала создадим группу. Она будет контейнером для всех объектов.
```
<group></group>
```

2. Затем добавим на сцену небо. Текстуру можно загрузить свою, но нам подойдет стандартная.
```
<Skybox />
```

3. Землю сделаем из растянутой коробки зеленого цвета
```
 <Box
  position={[0, -0.6, 0] /* сдвинем чуть вниз, поскольку 0 находится на уровне глаз*/}
  scale={[50, 0.2, 50] /* 50 на 50 по длине и ширине, 0.2 по высоте */}
  color="mediumseagreen"
/>
```

4. Земля получилась черная. Это потому что у нас пока нет источников света. Добавим немного окружающего света на фон
```
<ambientLight intensity={0.3} />
```

5. Самое время осмотреться вокруг. Добавим такую возможность:
```
<PointerLockControls selector="canvas" />
```
Атрибут `selector` содержит CSS селектор элемента, на который нужно кликнуть, чтобы перейти в режим обзора. В данном случае это элемент `"canvas"` - холст нашей сцены.

6. Нарисуем еще что-нибудь
```
<Box position={[0, 0, -2]} />
```
Новая коробка появилась явно не в двух метрах от нас. Это потому что камера по умолчанию находится не в начале координат.
```
<Camera position={[0, 0, 0]} />
```

7. Давайте обойдем коробку с разных сторон. Для этого обернем ее в компонент `<KbMovable>`
```
<KbMovable>
  <Box position={[0, 0, -2]} />
</KbMovable>
```
Трюк в том, что мы передвигаем не камеру по сцене, а сцену вокруг камеры. Это делается для того чтобы игрок не мог учесать так далеко от начала координат, что картинка испортится из-за ошибок округления больших чисел как в Далеких Землях Minecraft. Поэтому все, что должно двигаться относительно игрока, засовывается внутрь тэга `<KbMovable></KbMovable>`

8. Сделаем ходьбу более приятной и реалистичной. Уменьшим скорость, перенесем землю в список `<KbMovable>` объектов и добавим эффект движения головы при шагах (head bobbing):
```
<Bobbing amplitude={0.025} duration={250}>
  <KbMovable speed={0.5}>
    <Box
      position={[0, -0.6, 0]}
      scale={[50, 0.2, 50]}
      color="mediumseagreen"
    />
    <Box position={[0, 0, -2]} />
  </KbMovable>
</Bobbing>
```

9. Уберем возможность ходить сквозь стены. Для этого у коробок есть атрибут `collide`:
```
<Box position={[0, 0, -2]} collide />
```

10. В качестве финального штриха давайте улучшим освещение. Добавим лампу:
```
<pointLight position={[15, 10, 1]} intensity={0.5} castShadow />
```
Разрешим стене отбрасывать тень на землю:
```
<Box position={[0, 0, -2]} collide castShadow />
```
А земле - принимать отброшенные тени:
```
<Box
  position={[0, -0.6, 0]}
  scale={[50, 0.2, 50]}
  color="mediumseagreen"
  receiveShadow
/>
```
Вот весь код вместе:
```
<group>
    <Skybox />
    <ambientLight intensity={0.3} />
    <PointerLockControls selector="canvas" />
    <Camera position={[0, 0, 0]} />
    <Bobbing amplitude={0.025} duration={350}>
      <KbMovable speed={0.5}>
        <Box
          position={[0, -0.6, 0]}
          scale={[50, 0.2, 50]}
          color="mediumseagreen"
          receiveShadow
        />
        <pointLight position={[15, 10, 1]} intensity={0.5} castShadow />
        <Box
          position={[0, 0, -2]}
          collide
          castShadow
        />
      </KbMovable>
    </Bobbing>
  </group>
```

11. Теперь осталось вставить еще несколько коробок и соорудить из них лабиринт с пачки хлопьев, которыми вы сегодня завтракали. Ваш артхаусный симулятор ходьбы готов. Именно так чувствует себя Хидео Кодзима, завершая работу над очередной игрой. Работающий пример можно найти в файле `demo.tsx`.

Приходите на занятие, в следующий раз я буду показывать, как запрограммировать игровую логику при помощи Javascript, а также как добавить на сцену интерактивные объекты, способные выполнять код при взаимодействии с ними.
